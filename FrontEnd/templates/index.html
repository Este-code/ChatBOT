{% extends "base.html" %}
{% block title %}Home Page{% endblock %}
{% block content %}
<h1>Test</h1>
<a href="{{ url_for('test') }}">
  Carica documento
</a>
<div class="container">
  <form id="questionForm">
    <div class="input-group">
      <input type="text" name="question" id="question" class="form-control" placeholder="Q&A">
      <button class="btn btn-outline-primary" type="submit">Chiedi</button>
    </div>
  </form>
  <br>
  <div id="apiResponse"></div>
  <script>
     document.getElementById('questionForm').addEventListener('submit', function(event) {
            // Prevent the default form submission behavior
            event.preventDefault();
            
            // Get the value of the question input field
            var question = document.getElementById('question').value;

            // Make the fetch request with the POST method and the question data
            fetch('/qa', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    question: question
                })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to submit question: ' + response.statusText);
                }
                return response.json();
            })
            .then(data => {
                // Process the response data
                console.log(data);
                // Generate HTML for the table
                let tableHTML = '<table class="table table-striped">';
                tableHTML += `<tbody><tr>
                                    <td>${data.answer[0]}</td>
                                    <td>${data.answer[1]}</td>
                                    <td>${data.answer[2]}</td>
                                    <td>${data.answer[3]}</td>
                            </tr></tbody>`;
                tableHTML += '</table>';

                document.getElementById('apiResponse').innerHTML = tableHTML;
            })
            .catch(error => {
                console.error('Error submitting question:', error);
                // Display an error message to the user
            });
        });
  </script> 
  <br><br><br>
  <h3>History:</h3>
  <div id="apiMemory"></div>
  <script>
    document.getElementById('questionForm').addEventListener('submit', function(event) {
           // Prevent the default form submission behavior
           event.preventDefault();

           // Make the fetch request with the POST method and the question data
           fetch('/getMemories', {
               method: 'POST',
               headers: {
                   'Content-Type': 'application/json'
               }
           })
           .then(response => {
               if (!response.ok) {
                   throw new Error('Failed to submit question: ' + response.statusText);
               }
               return response.json();
           })
           .then(data => {
               // Process the response data
               console.log(data);
                       // Generate HTML for the table
                let tableHTML = '<table class="table table-striped">';
                tableHTML += '<tr><th>ID</th><th>Timestamp</th><th>User</th><th>Topic</th><th>Request</th><th>Response</th></tr>';
                data.forEach(memory => {
                    tableHTML += `<tr>
                                        <td>${memory.id}</td>
                                        <td>${memory.timestamp}</td>
                                        <td>${memory.user}</td>
                                        <td>${memory.topic}</td>
                                        <td>${memory.request}</td>
                                        <td>${memory.response}</td>
                                </tr>`;
                });
                tableHTML += '</table>';
                
                // Insert the generated HTML into the div with id 'apiMemory'
                document.getElementById('apiMemory').innerHTML = tableHTML;
           })
           .catch(error => {
               console.error('Error submitting question:', error);
               // Display an error message to the user
           });
       });
 </script> 

</div>


{% endblock %}